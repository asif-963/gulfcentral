{% extends "admin_pages/base.html" %}
{% load static %}

{% block content %}
<style>
  .table-responsive-custom {
    max-height: 75vh;
    overflow: auto;
    border: 1px solid #ddd;
    border-radius: 5px;
  }

  .table-responsive-custom thead th {
    position: sticky;
    top: 0;
    background-color: #343a40;
    color: #fff;
    z-index: 10;
    text-align: center;
  }

  .table td, .table th {
    vertical-align: middle;
    white-space: normal;
    word-wrap: break-word;
  }

  .desc-preview, .steps-preview, .faq-preview {
    max-width: 250px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: inline-block;
    vertical-align: middle;
  }

  .view-full-btn {
    display: inline-block;
    font-size: 0.85rem;
    padding: 0;
    margin-left: 5px;
    color: #007bff;
    cursor: pointer;
    border: none;
    background: none;
  }

  .view-full-btn:hover {
    text-decoration: underline;
  }

  .table img {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 5px;
    display: block;
    margin: 0 auto;
  }

  @media (max-width: 992px) {
    .desc-preview, .steps-preview, .faq-preview {
      max-width: 150px;
      font-size: 0.85rem;
    }

    .view-full-btn {
      font-size: 0.75rem;
    }
  }

  @media (max-width: 576px) {
    .desc-preview, .steps-preview, .faq-preview {
      max-width: 100px;
      font-size: 0.75rem;
    }

    .view-full-btn {
      font-size: 0.7rem;
    }
  }
</style>


<div class="container mt-4">
  <h3>Blogs</h3> <br>
  <a href="{% url 'add_blog' %}" 
     class="btn btn-primary mb-3"
     style="background-color: rgb(18, 18, 114); border-color: black;">
     Add Blog
  </a>

  <div class="table-responsive-custom">
    <table class="table table-bordered table-striped table-hover">
      <thead>
        <tr>
          <th style="width: 50px;">#</th>
          <th style="width: 200px;">Title</th>
          <th style="width: 150px;">Category</th>
          <th style="width: 350px;">Description</th>
          <th style="width: 150px;">Image</th>
          <th style="width: 150px;">Created Date</th>
          <th style="width: 100px;">Update</th>
          <th style="width: 100px;">Delete</th>
        </tr>
      </thead>
      <tbody>
        {% for blog in blogs %}
        <tr>
          <td>{{ forloop.counter }}</td>
          <td>{{ blog.title }}</td>
          <td>{{ blog.category.name }}</td>
          <td>
            <div class="desc-preview">{{ blog.description|striptags }}</div>
            <button class="btn btn-link p-0" 
                    data-toggle="modal" 
                    data-target="#descModal{{ blog.id }}">
              View Full
            </button>

            <!-- Modal for full description -->
            <div class="modal fade" id="descModal{{ blog.id }}" tabindex="-1" role="dialog">
              <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title">{{ blog.title }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body">
                    {{ blog.description|safe }}
                  </div>
                </div>
              </div>
            </div>
          </td>
          <td>
            {% if blog.image %}
              <img src="{{ blog.image.url }}" alt="Blog Image" style="width: 80px; height: 80px; object-fit: cover;">
            {% else %}
              <p>No Image</p>
            {% endif %}
          </td>
          <td>{{ blog.created_date|date:"d-m-Y H:i" }}</td>
          <td>
            <a href="{% url 'update_blog' blog.id %}" class="btn btn-warning btn-sm">Update</a>
          </td>
          <td>
            <a href="{% url 'delete_blog' blog.id %}" 
               class="btn btn-danger btn-sm" 
               onclick="return confirm('Are you sure?')">Delete</a>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="8" class="text-center">No Blogs available.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Bootstrap JS (needed for modal) -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
