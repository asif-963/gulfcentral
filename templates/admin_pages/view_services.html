{% extends "admin_pages/base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

<div class="col-lg-12 stretch-card">
  <div class="card">
    <div class="card-body">
      <h4 class="card-title">Services</h4>
      <a href="{% url 'add_service' %}" class="btn btn-primary mb-3" style="background-color: rgb(13, 13, 85); border-color: black;">
        <i class="fa fa-plus"></i> Add Service
      </a>

      <!-- Responsive scrollable table wrapper -->
      <div class="table-responsive" style="max-height: 600px; overflow: auto; border: 1px solid #dee2e6;">
        <table class="table table-bordered table-hover" style="width: 1500px;">
          <thead class="thead-light">
            <tr>
              <th>Name</th>
              <th>Category</th>
              <th>Image</th>
              <th>Description</th>
              <th>Process Steps</th>
              <th>FAQs</th>
              <th>Update</th>
              <th>Delete</th>
            </tr>
          </thead>
          <tbody>
            {% for service in services %}
            <tr>
              <td style="width: 150px;">{{ service.name }}</td>
              <td style="width: 150px;">{{ service.category.menu.name }} â†’ {{ service.category.name }}</td>
              <td style="width: 100px;">
                {% if service.image %}
                  <img src="{{ service.image.url }}" alt="Service Image" style="width: 80px; height: 80px; object-fit: cover; border-radius: 5px;">
                {% else %}
                  <p>No image</p>
                {% endif %}
              </td>
              <td style="max-width: 300px; white-space: normal; word-wrap: break-word; overflow-wrap: break-word; padding: 10px;">
                {{ service.description|safe }}
              </td>
              <td style="max-width: 300px; white-space: normal; word-wrap: break-word; overflow-wrap: break-word; padding: 10px;">
                {% if service.process_steps.exists %}
                  {% for step in service.process_steps.all %}
                    <strong>Step {{ step.step_number }}:</strong> {{ step.title }}<br>
                    <em>{{ step.description }}</em><hr>
                  {% endfor %}
                {% else %}
                  <em>No Steps</em>
                {% endif %}
              </td>
              <td style="max-width: 300px; white-space: normal; word-wrap: break-word; overflow-wrap: break-word; padding: 10px;">
                {% if service.faqs.exists %}
                  {% for faq in service.faqs.all %}
                    <strong>Q:</strong> {{ faq.question }}<br>
                    <strong>A:</strong> {{ faq.answer }}<hr>
                  {% endfor %}
                {% else %}
                  <em>No FAQs</em>
                {% endif %}
              </td>
              <td class="text-center">
                <a href="{% url 'update_service' service.id %}" class="btn btn-warning btn-sm">
                  <i class="fa fa-edit"></i> Update
                </a>
              </td>
              <td class="text-center">
                <a href="{% url 'delete_service' service.id %}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this service?');">
                  <i class="fa fa-trash"></i> Delete
                </a>
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="8" class="text-center">No services available.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <!-- End scrollable table -->

    </div>
  </div>
</div>

<!-- Sticky header styling -->
<style>
.table thead th {
  position: sticky;
  top: 0;
  background: #f8f9fa;
  z-index: 10;
  text-align: center;
}

.table td {
  vertical-align: middle;
  white-space: normal;
  word-wrap: break-word;
}

.table td img {
  display: block;
  margin: 0 auto;
}

/* Optional scrollbars */
div[style*="overflow: auto"]::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}
div[style*="overflow: auto"]::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.2);
  border-radius: 4px;
}
</style>
{% endblock %}
