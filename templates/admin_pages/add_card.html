{% extends "admin_pages/base.html" %}
{% load static %}

{% block content %}
<style>
.scrollable-form {
  height: 80vh;            
  overflow-y: auto;         
  -ms-overflow-style: none; 
  scrollbar-width: none;    
}
.scrollable-form::-webkit-scrollbar {
  display: none;            
}
.plan-card {
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 20px;
  margin-bottom: 20px;
  background-color: #fff;
  box-shadow: 0 1px 4px rgba(0,0,0,0.05);
}
.feature-input {
  margin-bottom: 10px;
}
.remove-feature-btn, .remove-plan-btn {
  cursor: pointer;
}
</style>

<div class="container scrollable-form">
  <h3 class="mb-4">Add Pricing Section</h3>
  <form method="POST" id="pricingForm">
    {% csrf_token %}
    
    <!-- Section Title -->
    <div class="form-group mb-3">
      <label>Section Title</label>
      <input type="text" name="section_title" class="form-control" placeholder="Enter Section Title" required>
    </div>

    <!-- Section Description -->
    <div class="form-group mb-4">
      <label>Section Description</label>
      <textarea name="section_description" class="form-control" rows="3" placeholder="Enter Section Description"></textarea>
    </div>

    <!-- Container for dynamic plans -->
    <div id="plans-container"></div>

    <!-- Buttons -->
    <button type="button" class="btn btn-primary mb-3" id="add-plan-btn">Add Plan</button>
    <br>
    <button type="submit" class="btn btn-success">Save Pricing Section</button>
  </form>
</div>

<script>
let planCount = 0;

// Add Plan dynamically
document.getElementById('add-plan-btn').addEventListener('click', function() {
    const container = document.getElementById('plans-container');
    const planDiv = document.createElement('div');
    planDiv.classList.add('plan-card');
    
    planDiv.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="mb-0">Plan ${planCount + 1}</h5>
            <span class="text-danger remove-plan-btn">Remove Plan</span>
        </div>
        <div class="form-group mb-2">
            <label>Plan Title</label>
            <input type="text" name="plans[${planCount}][title]" class="form-control" placeholder="Enter Plan Title" required>
        </div>
        <div class="form-group mb-2">
            <label>Plan Description</label>
            <textarea name="plans[${planCount}][description]" class="form-control" rows="3" placeholder="Enter Plan Description"></textarea>
        </div>
        <div class="features-container border-top pt-2 mt-2">
            <h6>Features</h6>
            <div class="feature-inputs mb-2"></div>
            <button type="button" class="btn btn-sm btn-secondary add-feature-btn">Add Feature</button>
        </div>
    `;
    container.appendChild(planDiv);
    planCount++;
});

// Add Feature / Remove Plan dynamically
document.addEventListener('click', function(e) {
    // Add feature
    if(e.target.classList.contains('add-feature-btn')) {
        const featureContainer = e.target.previousElementSibling;
        const planDiv = e.target.closest('.plan-card');
        const planIndex = Array.from(document.querySelectorAll('.plan-card')).indexOf(planDiv);
        const input = document.createElement('input');
        input.type = 'text';
        input.name = `plans[${planIndex}][features][]`;
        input.placeholder = 'Feature text';
        input.classList.add('form-control', 'feature-input');
        featureContainer.appendChild(input);
    }

    // Remove plan
    if(e.target.classList.contains('remove-plan-btn')) {
        e.target.closest('.plan-card').remove();
    }
});
</script>
{% endblock %}
